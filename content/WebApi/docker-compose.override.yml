version: '3.4'

services:
    webapi.api:
        image: ${DOCKER_REGISTRY-}webapiapi
        restart: unless-stopped
        environment:
            - ASPNETCORE_URLS=https://+:443;http://+:80
            - ASPNETCORE_ENVIRONMENT=Development
            - AWS_ACCESS_KEY_ID=guest
            - AWS_SECRET_ACCESS_KEY=guest
            - AWS_DEFAULT_REGION=us-east-1
            - ConnectionStrings__DefaultConnection=Server=postgres;Port=5432;Database=postgres;User Id=admin;Password=password;
            - MessageQueueOptions__ServiceURL=http://localstack:4566
            - MessageQueueOptions__Region=us-east-1
            - MessageQueueOptions__GroupId=WorkerService
            - MessageQueueOptions__WaitTimeSeconds=1
            - MessageQueueOptions__VisibilityTimeout=1
            - MessageQueueOptions__EnableFifo=true
            - MessageQueueOptions__RequestDelaySeconds=2
        build:
            context: .
            dockerfile: WebApi.Api/Dockerfile
        ports:
            - "5000:80"
            - "5001:443"
        volumes:
            - ${APPDATA}/Microsoft/UserSecrets:/root/.microsoft/usersecrets:ro
            - ${APPDATA}/ASP.NET/Https:/root/.aspnet/https:ro